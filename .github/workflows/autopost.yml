name: Auto Gemini Writer + Blogger

on:
  schedule:
    - cron: "*/30 * * * *" # chạy mỗi 30 phút
  workflow_dispatch:

jobs:
  write_and_post:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      # Xóa thư viện Google lỗi thời (tránh conflict)
      - name: Cleanup old google libs
        run: |
          pip uninstall -y google || true
          pip uninstall -y googleapis-common-protos || true

      # Cài toàn bộ thư viện cần thiết
      - name: Install libs
        run: |
          pip install google-genai
          pip install google-auth google-auth-oauthlib google-api-python-client
          pip install pyyaml Pillow beautifulsoup4 requests

      # Tạo bài viết từ Gemini
      - name: Generate Article (Gemini)
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python auto_generate_post_gemini.py

      # Đăng lên Blogger
      - name: Post to Blogger
        env:
          BLOG_ID: ${{ secrets.BLOG_ID }}
          TOKEN_JSON: ${{ secrets.TOKEN_JSON }}
        run: python post_to_blogger.py

      - name: Fake Update Blogger
        env:
          BLOG_ID: ${{ secrets.BLOG_ID }}
          BLOGGER_ACCESS_TOKEN: ${{ secrets.BLOGGER_ACCESS_TOKEN }}
        run: python fake_update_blogger.py
